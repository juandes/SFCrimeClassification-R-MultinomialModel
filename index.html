<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Sfcrimeclassification-r-multinomialmodel by juandes</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Sfcrimeclassification-r-multinomialmodel</h1>
        <p>Third attempt at the Kaggle competition &quot;San Francisco Crime Classification&quot;</p>

        <p class="view"><a href="https://github.com/juandes/SFCrimeClassification-R-MultinomialModel">View the Project on GitHub <small>juandes/SFCrimeClassification-R-MultinomialModel</small></a></p>


        <ul>
          <li><a href="https://github.com/juandes/SFCrimeClassification-R-MultinomialModel/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/juandes/SFCrimeClassification-R-MultinomialModel/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/juandes/SFCrimeClassification-R-MultinomialModel">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="san-francisco-crime-classification-kaggle-competition-using-r-and-multinomial-logistic-regression-via-neural-networks" class="anchor" href="#san-francisco-crime-classification-kaggle-competition-using-r-and-multinomial-logistic-regression-via-neural-networks" aria-hidden="true"><span class="octicon octicon-link"></span></a>San Francisco Crime Classification (Kaggle competition) using R and multinomial logistic regression via neural networks</h1>

<h2>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h2>

<hr>

<p>The "San Francisco Crime Classification" challenge, is a <a href="https://www.kaggle.com">Kaggle</a> competition aimed to predict the category of the crimes that occurred in the city, given the time and location of the incident.</p>

<p>In this post, I explain and outline my third solution to this challenge. This time using R (again).</p>

<p>Link to the competition: <a href="https://www.kaggle.com/c/sf-crime">San Francisco Crime Classification</a></p>

<h2>
<a id="learning-method" class="anchor" href="#learning-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>Learning method</h2>

<hr>

<p>The algorithm chosen for this solution, is a variation of <a href="https://en.wikipedia.org/wiki/Multinomial_logistic_regression">multinomial logistic regression</a>, a classification model based on regression where the dependent variable (what we want to predict) is categorical (opposite of continuous), implemented using <a href="https://stat.ethz.ch/R-manual/R-devel/library/nnet/html/multinom.html">neural networks</a>.</p>

<h2>
<a id="data" class="anchor" href="#data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data</h2>

<hr>

<p>The competition provides two dataset: a train data set and a test dataset. The
train dataset is made of 878049 observations and the test dataset, of 884262
observations.</p>

<p>Both of them contains incidents from January 1, 2003 to May 13, 2015.</p>

<h3>
<a id="data-fields" class="anchor" href="#data-fields" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data fields</h3>

<p>These are the features of the datasets:</p>

<ul>
<li>Dates : timestamp of the crime incident.</li>
<li>Category: Category of the incident. Also, this is the variable we want to predict.
This variable is available only in the train dataset.</li>
<li>Descript: A short description of the incident. This variable is available only 
in the train dataset.</li>
<li>DayOfWeek: Day of the week where the incident occurred.</li>
<li>PdDistrict: Police Department District</li>
<li>Resolution: Outcome of the incident. This variable is available only in the 
train dataset.</li>
<li>Address: Address of the incident.</li>
<li>X: Longitude</li>
<li>Y: Latitude</li>
</ul>

<h2>
<a id="model-development" class="anchor" href="#model-development" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model development</h2>

<hr>

<h4>
<a id="package-installation-and-data-loading" class="anchor" href="#package-installation-and-data-loading" aria-hidden="true"><span class="octicon octicon-link"></span></a>Package installation and data loading</h4>

<p>For this solution, I used the <code>nnet</code> package. To install it, simply run this command in R.</p>

<div class="highlight highlight-source-r"><pre>install.packages(<span class="pl-s"><span class="pl-pds">'</span>nnet<span class="pl-pds">'</span></span>)</pre></div>

<p>Once the package is downloaded , the next step is calling the library, followed by setting the working directory, and loading both datasets.</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">nnet</span>)
setwd(<span class="pl-s"><span class="pl-pds">"</span>~/path/to/working/directory<span class="pl-pds">"</span></span>)
<span class="pl-smi">train</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>~/path/to/working/directory/train.csv<span class="pl-pds">"</span></span>)
<span class="pl-smi">test</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>~/path/to/working/directory/test.csv<span class="pl-pds">"</span></span>)</pre></div>

<h4>
<a id="preparing-the-dataset" class="anchor" href="#preparing-the-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preparing the dataset</h4>

<p>After loading the datasets, the next thing I did was creating a new dataframe with the columns needed (Category, DayOfWeek and PdDistrict), this way we can save precious memory space.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># New dataframes</span>
<span class="pl-smi">train.df</span> <span class="pl-k">&lt;-</span> <span class="pl-k">data.frame</span>(<span class="pl-v">Category</span> <span class="pl-k">=</span> <span class="pl-smi">train</span><span class="pl-k">$</span><span class="pl-smi">Category</span>, <span class="pl-v">DayOfWeek</span> <span class="pl-k">=</span> <span class="pl-smi">train</span><span class="pl-k">$</span><span class="pl-smi">DayOfWeek</span>,
                       <span class="pl-v">PdDistrict</span> <span class="pl-k">=</span> <span class="pl-smi">train</span><span class="pl-k">$</span><span class="pl-smi">PdDistrict</span>)
<span class="pl-smi">test.df</span> <span class="pl-k">&lt;-</span> <span class="pl-k">data.frame</span>(<span class="pl-v">DayOfWeek</span> <span class="pl-k">=</span> <span class="pl-smi">test</span><span class="pl-k">$</span><span class="pl-smi">DayOfWeek</span>, <span class="pl-v">PdDistrict</span> <span class="pl-k">=</span> <span class="pl-smi">test</span><span class="pl-k">$</span><span class="pl-smi">PdDistrict</span>)</pre></div>

<p>The next step is to add a new feature, the hour of the incident, to both datasets. This is done by calling the function <code>strftime</code> on the original date to remove just the hour.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Create a new column with the hour of the incident</span>
<span class="pl-smi">train.df</span><span class="pl-k">$</span><span class="pl-smi">Hour</span> <span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">train</span><span class="pl-k">$</span><span class="pl-smi">Dates</span>, <span class="pl-k">function</span>(<span class="pl-smi">x</span>) as.integer(strftime(<span class="pl-smi">x</span>, <span class="pl-v">format</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>%H<span class="pl-pds">"</span></span>)))
<span class="pl-smi">test.df</span><span class="pl-k">$</span><span class="pl-smi">Hour</span> <span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">test</span><span class="pl-k">$</span><span class="pl-smi">Dates</span>, <span class="pl-k">function</span>(<span class="pl-smi">x</span>) as.integer(strftime(<span class="pl-smi">x</span>, <span class="pl-v">format</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>%H<span class="pl-pds">"</span></span>)))</pre></div>

<p>Remove the original dataframes.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Remove the original dataframes</span>
rm(<span class="pl-smi">train</span>)
rm(<span class="pl-smi">test</span>)</pre></div>

<h4>
<a id="create-and-train-the-model" class="anchor" href="#create-and-train-the-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create and train the model.</h4>

<p>After pre-processing the data, the next step is to create and train the model. The model will predict the category of the crime using the day of the week when the incident occurred, the district where it occurred and the hour when it occurred, as the predictors.</p>

<p>Instead of the default value of 100 iterations, I changed it to 500. Keep in mind the model will take some time (around 45 mins in my set up) to finish the training.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Multinomial log-linear model using the day of the week,  the district of the crime</span>
<span class="pl-c"># and the hour of the incident as the predictors.</span>
<span class="pl-smi">multinom.model</span> <span class="pl-k">&lt;-</span> multinom(<span class="pl-smi">Category</span> <span class="pl-k">~</span> <span class="pl-smi">DayOfWeek</span> <span class="pl-k">+</span> <span class="pl-smi">PdDistrict</span> <span class="pl-k">+</span> <span class="pl-smi">Hour</span>, <span class="pl-v">data</span> <span class="pl-k">=</span> <span class="pl-smi">train.df</span>, 
                 <span class="pl-v">maxit</span> <span class="pl-k">=</span> <span class="pl-c1">500</span>)</pre></div>

<h4>
<a id="prediction-phase" class="anchor" href="#prediction-phase" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prediction phase</h4>

<p>Now we predict!</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">predictions</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">multinom.model</span>, <span class="pl-smi">test.df</span>, <span class="pl-s"><span class="pl-pds">"</span>probs<span class="pl-pds">"</span></span>)</pre></div>

<h4>
<a id="preparing-the-submission-file" class="anchor" href="#preparing-the-submission-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preparing the submission file</h4>

<p>To get a smaller file, I rounded down the number of digits.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">submission</span> <span class="pl-k">&lt;-</span> format(<span class="pl-smi">predictions</span>, <span class="pl-v">digits</span><span class="pl-k">=</span><span class="pl-c1">4</span>, <span class="pl-v">scientific</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>)
<span class="pl-smi">submission</span> <span class="pl-k">&lt;-</span> cbind(<span class="pl-v">id</span> <span class="pl-k">=</span> <span class="pl-c1">0</span><span class="pl-k">:</span><span class="pl-c1">884261</span>, <span class="pl-smi">submission</span>)
<span class="pl-smi">submission</span> <span class="pl-k">&lt;-</span> as.data.frame(<span class="pl-smi">submission</span>)
write.csv(<span class="pl-smi">submission</span>, <span class="pl-v">file</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>results.csv<span class="pl-pds">"</span></span>, <span class="pl-v">row.names</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>)</pre></div>

<h2>
<a id="conclusion" class="anchor" href="#conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion</h2>

<hr>

<p>The score received this time was way better than my previous attempts. First, I got a score of 26.74064, followed by 26.78360.
This time my score was 2.60502, which is a huge improvement. At the moment of writing, I do not have plans on improving the score, since I would like to tackle more advanced challenges.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/juandes">juandes</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
